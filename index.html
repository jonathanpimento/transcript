<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Podcast Transcript Analyzer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
            line-height: 1.5;
        }
        .container {
            background-color: #f9fafb;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .api-key-input {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
        }
        .file-input-wrapper {
            margin-bottom: 1rem;
        }
        #analyzeBtn {
            background-color: #2563eb;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }
        #analyzeBtn:disabled {
            background-color: #93c5fd;
            cursor: not-allowed;
        }
        #result {
            margin-top: 1rem;
        }
        .error {
            color: #dc2626;
            margin-top: 0.5rem;
        }
        .loading {
            display: none;
            margin-top: 1rem;
            color: #4b5563;
        }
        .result-section {
            margin-top: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 4px;
            border: 1px solid #e5e7eb;
        }
        .result-section h3 {
            color: #1e3a8a;
            font-size: 1.25rem;
            margin: 0 0 1rem 0;
        }
        .result-section h4 {
            color: #4b5563;
            font-size: 1rem;
            margin: 1rem 0 0.5rem 0;
        }
        .speaker-section {
            margin-bottom: 2rem;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 6px;
        }
        .speaker-section h4 {
            color: #1e40af;
            margin: 0 0 1rem 0;
            font-size: 1.1rem;
        }
        .speaker-section h5 {
            color: #4b5563;
            margin: 1rem 0 0.5rem 0;
            font-size: 0.95rem;
        }
        blockquote {
            border-left: 3px solid #2563eb;
            margin: 0.5rem 0;
            padding: 0.5rem 0 0.5rem 1rem;
            font-style: italic;
            color: #4b5563;
        }
        ul {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }
        li {
            margin-bottom: 0.5rem;
        }
        .social-share {
            background: #f0f9ff;
            padding: 1rem;
            border-radius: 4px;
            margin-top: 0.5rem;
        }
        .copy-btn {
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
            cursor: pointer;
            float: right;
        }
        .copy-btn:hover {
            background: #2563eb;
        }
        /* Timeline styles */
.timeline {
    position: relative;
    padding: 20px 0;
}

.timeline-item {
    position: relative;
    padding-left: 40px;
    margin-bottom: 20px;
}

.timeline-marker {
    position: absolute;
    left: 0;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: #2563eb;
    border: 2px solid #fff;
    box-shadow: 0 0 0 4px #dbeafe;
}

.timeline-item:before {
    content: '';
    position: absolute;
    left: 5px;
    top: 12px;
    bottom: -20px;
    width: 2px;
    background: #e5e7eb;
}

.timeline-item:last-child:before {
    display: none;
}

.timeline-content {
    padding: 15px;
    background: #f8fafc;
    border-radius: 6px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

.timeline-meta {
    font-size: 0.875rem;
    color: #6b7280;
    margin-bottom: 8px;
    display: flex;
    gap: 16px;
}

.timeline-meta span {
    display: inline-flex;
    align-items: center;
}

.timestamp:before {
    content: 'ðŸ•’';
    margin-right: 4px;
}

.duration:before {
    content: 'âŒ›';
    margin-right: 4px;
}

/* Speaker section enhancements */
.speaker-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 1rem;
    flex-wrap: wrap;
}

.speaker-role {
    font-size: 0.875rem;
    color: #4b5563;
    background: #f3f4f6;
    padding: 2px 8px;
    border-radius: 12px;
    white-space: nowrap;
}

.speaking-time {
    font-size: 0.875rem;
    color: #6b7280;
    margin-left: auto;
}

/* Metrics grid */
.metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.metric-item {
    background: #f8fafc;
    padding: 1rem;
    border-radius: 6px;
    border: 1px solid #e5e7eb;
    transition: transform 0.2s ease;
}

.metric-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.metric-label {
    font-size: 0.875rem;
    color: #4b5563;
    margin-bottom: 4px;
    text-transform: capitalize;
}

.metric-value {
    font-size: 1.125rem;
    font-weight: 500;
    color: #1e40af;
}

/* Tags */
.tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 8px;
}

.tag {
    background: #e5e7eb;
    color: #4b5563;
    padding: 4px 12px;
    border-radius: 16px;
    font-size: 0.875rem;
    transition: background-color 0.2s ease;
}

.tag:hover {
    background: #d1d5db;
}

/* Warning section */
.warning-section {
    background: #fff3cd;
    border-color: #ffeeba;
}

.warning-section h3 {
    color: #856404;
}

.warning-list li {
    color: #856404;
}

/* Resource categories */
.resource-category {
    margin-bottom: 1.5rem;
    padding: 1rem;
    background: #f8fafc;
    border-radius: 6px;
}

.resource-category h4 {
    color: #1e40af;
    margin-bottom: 0.75rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #e5e7eb;
}

.resource-category ul {
    columns: 2;
    column-gap: 2rem;
}

@media (max-width: 640px) {
    .resource-category ul {
        columns: 1;
    }
}

/* Audience list */
.audience-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    list-style: none;
    padding: 0;
}

.audience-list li {
    background: #dbeafe;
    color: #1e40af;
    padding: 4px 12px;
    border-radius: 16px;
    font-size: 0.875rem;
}

/* Social share enhancements */
.social-share {
    position: relative;
    background: #f0f9ff;
    padding: 1rem;
    border-radius: 6px;
    margin-top: 0.5rem;
    margin-bottom: 1rem;
}

.copy-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    background: #3b82f6;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 0.75rem;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.copy-btn:hover {
    background: #2563eb;
}

/* Flow section */
.flow-section ol {
    position: relative;
    counter-reset: flow-counter;
    list-style: none;
    padding-left: 2rem;
}

.flow-section ol li {
    counter-increment: flow-counter;
    margin-bottom: 1rem;
    position: relative;
}

.flow-section ol li:before {
    content: counter(flow-counter);
    position: absolute;
    left: -2rem;
    width: 1.5rem;
    height: 1.5rem;
    background: #2563eb;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.875rem;
}

/* Key points and insights */
.speaker-section ul:not(.talking-points) li {
    position: relative;
    padding-left: 1.5rem;
}

.speaker-section ul:not(.talking-points) li:before {
    content: 'â†’';
    position: absolute;
    left: 0;
    color: #2563eb;
}

.talking-points {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    list-style: none;
    padding: 0;
}

.talking-points li {
    background: #f3f4f6;
    padding: 4px 12px;
    border-radius: 16px;
    font-size: 0.875rem;
    color: #4b5563;
}

/* Actionable insights */
.actionable-list li {
    background: #f0fdf4;
    padding: 1rem;
    border-radius: 6px;
    margin-bottom: 0.5rem;
    border-left: 4px solid #22c55e;
}

/* Follow-up topics */
.follow-up-list li {
    background: #faf5ff;
    padding: 0.75rem;
    border-radius: 6px;
    margin-bottom: 0.5rem;
    border-left: 4px solid #8b5cf6;
}
</style>
</head>
<body>
    <div class="container">
        <h1>Podcast Transcript Analyzer Deep</h1>
        
        <div>
            <label for="apiKey">Claude API Key:</label>
            <input type="password" id="apiKey" class="api-key-input" placeholder="Enter your API key">
        </div>

        <div class="file-input-wrapper">
            <label for="pdfFile">Select Transcript PDF:</label>
            <input type="file" id="pdfFile" accept=".pdf">
        </div>

        <button id="analyzeBtn" disabled>Analyze Transcript</button>
        
        <div id="loading" class="loading">
            Analyzing transcript... This may take a few moments.
        </div>
        
        <div id="result"></div>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        const apiKeyInput = document.getElementById('apiKey');
        const fileInput = document.getElementById('pdfFile');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const resultDiv = document.getElementById('result');
        const loadingDiv = document.getElementById('loading');

        function updateButtonState() {
            analyzeBtn.disabled = !apiKeyInput.value || !fileInput.files[0];
        }

        apiKeyInput.addEventListener('input', updateButtonState);
        fileInput.addEventListener('change', updateButtonState);

        async function extractTextFromPdf(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let text = '';
            
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const content = await page.getTextContent();
                text += content.items.map(item => item.str).join(' ') + '\n';
            }
            
            return text;
        }

        function addCopyButtons() {
            document.querySelectorAll('.social-share').forEach(shareDiv => {
                const text = shareDiv.textContent;
                const copyBtn = document.createElement('button');
                copyBtn.textContent = 'Copy';
                copyBtn.className = 'copy-btn';
                copyBtn.onclick = async () => {
                    await navigator.clipboard.writeText(text);
                    copyBtn.textContent = 'Copied!';
                    setTimeout(() => copyBtn.textContent = 'Copy', 2000);
                };
                shareDiv.insertBefore(copyBtn, shareDiv.firstChild);
            });
        }

function formatResults(analysis) {
    try {
        const data = JSON.parse(analysis);
        let html = '';
        
        // Podcast Summary
        if (data.podcastSummary) {
            html += `
                <div class="result-section">
                    <h3>Podcast Summary</h3>
                    <p>${data.podcastSummary}</p>
                </div>
            `;
        }
        
        // Social Share Text
        if (data.socialShareText) {
            html += `
                <div class="result-section">
                    <h3>Social Media Content</h3>
                    ${Object.entries(data.socialShareText).map(([platform, text]) => `
                        <h4>${platform.charAt(0).toUpperCase() + platform.slice(1)}</h4>
                        <div class="social-share">${text}</div>
                    `).join('')}
                </div>
            `;
        }

        // Key Topics Timeline
        if (data.keyTopics && data.keyTopics.length) {
            html += `
                <div class="result-section">
                    <h3>Discussion Timeline</h3>
                    <div class="timeline">
                        ${data.keyTopics.map(topic => `
                            <div class="timeline-item">
                                <div class="timeline-marker"></div>
                                <div class="timeline-content">
                                    <h4>${topic.topic}</h4>
                                    <div class="timeline-meta">
                                        <span class="timestamp">${topic.timestamp}</span>
                                        <span class="duration">${topic.duration}</span>
                                    </div>
                                    <p>${topic.summary}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        // Speaker Insights
        if (data.speakerInsights && data.speakerInsights.length) {
            html += `
                <div class="result-section">
                    <h3>Speaker Insights</h3>
                    ${data.speakerInsights.map(speaker => `
                        <div class="speaker-section">
                            <div class="speaker-header">
                                <h4>${speaker.name}</h4>
                                ${speaker.role ? `<span class="speaker-role">${speaker.role}</span>` : ''}
                                ${speaker.speakingTime ? `<span class="speaking-time">Speaking Time: ${speaker.speakingTime}</span>` : ''}
                            </div>
                            ${speaker.keyPoints && speaker.keyPoints.length ? `
                                <h5>Key Points</h5>
                                <ul>
                                    ${speaker.keyPoints.map(point => `<li>${point}</li>`).join('')}
                                </ul>
                            ` : ''}
                            ${speaker.talkingPoints && speaker.talkingPoints.length ? `
                                <h5>Focus Areas</h5>
                                <ul class="talking-points">
                                    ${speaker.talkingPoints.map(point => `<li>${point}</li>`).join('')}
                                </ul>
                            ` : ''}
                            ${speaker.bestQuote ? `
                                <h5>Notable Quote</h5>
                                <blockquote>${speaker.bestQuote}</blockquote>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Conversation Flow
        if (data.conversationFlow) {
            html += `
                <div class="result-section">
                    <h3>Conversation Flow</h3>
                    <div class="flow-section">
                        <h4>Opening</h4>
                        <p>${data.conversationFlow.openingTopic}</p>
                        ${data.conversationFlow.mainDiscussions && data.conversationFlow.mainDiscussions.length ? `
                            <h4>Main Discussion Points</h4>
                            <ol>
                                ${data.conversationFlow.mainDiscussions.map(point => `<li>${point}</li>`).join('')}
                            </ol>
                        ` : ''}
                        <h4>Closing</h4>
                        <p>${data.conversationFlow.closingThoughts}</p>
                    </div>
                </div>
            `;
        }

        // Podcast Metrics
        if (data.podcastMetrics) {
            html += `
                <div class="result-section">
                    <h3>Podcast Metrics</h3>
                    <div class="metrics-grid">
                        ${Object.entries(data.podcastMetrics)
                            .filter(([key, value]) => !Array.isArray(value))
                            .map(([key, value]) => `
                                <div class="metric-item">
                                    <div class="metric-label">${key.replace(/([A-Z])/g, ' $1').trim()}</div>
                                    <div class="metric-value">${value}</div>
                                </div>
                            `).join('')}
                    </div>
                    ${data.podcastMetrics.technicalTermsUsed && data.podcastMetrics.technicalTermsUsed.length ? `
                        <h4>Technical Terms Used</h4>
                        <div class="tags">
                            ${data.podcastMetrics.technicalTermsUsed.map(term => `
                                <span class="tag">${term}</span>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // Content Warnings
        if (data.contentWarnings && data.contentWarnings.length) {
            html += `
                <div class="result-section warning-section">
                    <h3>Content Notes</h3>
                    <ul class="warning-list">
                        ${data.contentWarnings.map(warning => `<li>${warning}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        // Actionable Insights
        if (data.actionableInsights && data.actionableInsights.length) {
            html += `
                <div class="result-section">
                    <h3>Key Takeaways</h3>
                    <ul class="actionable-list">
                        ${data.actionableInsights.map(insight => `<li>${insight}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        // Follow-up Topics
        if (data.followUpTopics && data.followUpTopics.length) {
            html += `
                <div class="result-section">
                    <h3>Potential Follow-up Topics</h3>
                    <ul class="follow-up-list">
                        ${data.followUpTopics.map(topic => `<li>${topic}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        // Resources Mentioned
        if (data.resourcesMentioned) {
            html += `
                <div class="result-section">
                    <h3>Resources Mentioned</h3>
                    ${Object.entries(data.resourcesMentioned).map(([category, items]) => 
                        items && items.length ? `
                            <div class="resource-category">
                                <h4>${category.charAt(0).toUpperCase() + category.slice(1)}</h4>
                                <ul>
                                    ${items.map(item => `<li>${item}</li>`).join('')}
                                </ul>
                            </div>
                        ` : ''
                    ).join('')}
                </div>
            `;
        }
        
        // Categories and Target Audience
        if (data.podcastCategories) {
            html += `
                <div class="result-section">
                    <h3>Podcast Categories</h3>
                    <p><strong>Primary Category:</strong> ${data.podcastCategories.primaryCategory}</p>
                    ${data.podcastCategories.subCategories && data.podcastCategories.subCategories.length ? `
                        <p><strong>Sub-Categories:</strong> ${data.podcastCategories.subCategories.join(', ')}</p>
                    ` : ''}
                    ${data.podcastCategories.targetAudience && data.podcastCategories.targetAudience.length ? `
                        <h4>Target Audience</h4>
                        <ul class="audience-list">
                            ${data.podcastCategories.targetAudience.map(audience => `<li>${audience}</li>`).join('')}
                        </ul>
                    ` : ''}
                </div>
            `;
        }
        
        return html;
    } catch (e) {
        return `<div class="result-section">${analysis}</div>`;
    }
}

        async function analyzePdfWithClaude(text) {
const prompt = `Analyze this podcast transcript and provide comprehensive insights in the following JSON format:

{
    "podcastSummary": "A concise 2-3 sentence summary of the overall podcast discussion",
    
    "socialShareText": {
        "twitter": "An engaging, catchy 280-character summary suitable for Twitter",
        "linkedin": "A professional, compelling 1-2 sentence summary suitable for LinkedIn",
        "instagram": "An engaging summary with relevant hashtags"
    },

    "keyTopics": [
        {
            "topic": "Name of the topic",
            "timestamp": "Approximate timestamp or location in conversation",
            "duration": "Approximate duration of discussion",
            "summary": "Brief summary of the discussion on this topic"
        }
    ],
    
    "speakerInsights": [
        {
            "name": "Speaker's name",
            "role": "Speaker's role or expertise",
            "keyPoints": [
                "3-4 main points or insights from this speaker"
            ],
            "bestQuote": "Most impactful or memorable quote from this speaker",
            "talkingPoints": [
                "List of main topics this speaker focused on"
            ],
            "speakingTime": "Approximate percentage of total conversation"
        }
    ],

    "conversationFlow": {
        "openingTopic": "How the conversation started",
        "mainDiscussions": [
            "Sequential flow of major discussion points"
        ],
        "closingThoughts": "How the conversation concluded"
    },
    
    "podcastMetrics": {
        "estimatedDuration": "Approximate length of the podcast",
        "speakerCount": "Number of unique speakers",
        "topicsCount": "Number of distinct topics discussed",
        "interactionType": "Type of conversation (interview, panel, debate, etc.)",
        "technicalTermsUsed": [
            "List of technical or specialized terms used"
        ]
    },

    "contentWarnings": [
        "Any sensitive topics or explicit content mentioned"
    ],
    
    "actionableInsights": [
        "List of practical takeaways or lessons for listeners"
    ],

    "followUpTopics": [
        "Potential topics for future episodes based on unanswered questions or briefly touched subjects"
    ],

    "podcastCategories": {
        "primaryCategory": "Main category",
        "subCategories": [
            "2-3 more specific subcategories"
        ],
        "targetAudience": [
            "Types of listeners who would find this most valuable"
        ]
    },

    "resourcesMentioned": {
        "books": ["Books mentioned"],
        "links": ["Websites or resources discussed"],
        "people": ["People referenced"],
        "companies": ["Companies or organizations mentioned"]
    }
}

Important instructions:
1. Identify speakers and their roles from context
2. Make social text engaging and include value proposition
3. For quotes, prioritize insightful or memorable statements
4. Use standard category names
5. Be specific about timestamps and topic transitions
6. Include any technical terms or jargon explained in the conversation
7. Note any content warnings or sensitive topics
8. Identify clear calls to action or takeaways
9. Track all external references and resources

Here is the podcast transcript to analyze:

${text}`;

            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': apiKeyInput.value,
                    'anthropic-version': '2023-06-01',
                    'anthropic-dangerous-direct-browser-access': 'true'
                },
                body: JSON.stringify({
                    model: 'claude-3-haiku-20240307',
                    max_tokens: 1024,
                    messages: [{
                        role: 'user',
                        content: prompt
                    }]
                })
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`API Error: ${response.status} ${errorText}`);
            }

            const data = await response.json();
            return data.content[0].text;
        }

        analyzeBtn.addEventListener('click', async () => {
            try {
                resultDiv.textContent = '';
                loadingDiv.style.display = 'block';
                analyzeBtn.disabled = true;

                const file = fileInput.files[0];
                const text = await extractTextFromPdf(file);
                const analysis = await analyzePdfWithClaude(text);
                resultDiv.innerHTML = formatResults(analysis);
                addCopyButtons();
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            } finally {
                loadingDiv.style.display = 'none';
                analyzeBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
