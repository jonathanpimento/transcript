<!DOCTYPE html>
<html lang="en">
<!-- Previous head and style sections remain the same -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Analyzer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        /* Previous styles remain the same */
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
            line-height: 1.5;
        }
        .container {
            background-color: #f9fafb;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .api-key-input {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
        }
        .file-input-wrapper {
            margin-bottom: 1rem;
        }
        #analyzeBtn {
            background-color: #2563eb;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }
        #analyzeBtn:disabled {
            background-color: #93c5fd;
            cursor: not-allowed;
        }
        #result {
            margin-top: 1rem;
            white-space: pre-wrap;
        }
        .error {
            color: #dc2626;
            margin-top: 0.5rem;
        }
        .loading {
            display: none;
            margin-top: 1rem;
            color: #4b5563;
        }
        .result-section {
            margin-top: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 4px;
            border: 1px solid #e5e7eb;
        }
        .result-section h3 {
            margin-top: 0;
            color: #1f2937;
        }
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="warning">
            ⚠️ Note: This demo uses a CORS proxy for testing. For production use, you should implement a proper backend service.
        </div>
        
        <h1>PDF Analyzer</h1>
        
        <div>
            <label for="apiKey">Claude API Key:</label>
            <input type="password" id="apiKey" class="api-key-input" placeholder="Enter your API key">
        </div>

        <div class="file-input-wrapper">
            <label for="pdfFile">Select PDF:</label>
            <input type="file" id="pdfFile" accept=".pdf">
        </div>

        <button id="analyzeBtn" disabled>Analyze PDF</button>
        
        <div id="loading" class="loading">
            Analyzing PDF... This may take a few moments.
        </div>
        
        <div id="result"></div>
    </div>

    <script>
        // Initialize PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        const apiKeyInput = document.getElementById('apiKey');
        const fileInput = document.getElementById('pdfFile');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const resultDiv = document.getElementById('result');
        const loadingDiv = document.getElementById('loading');

        // Previous helper functions remain the same
        function updateButtonState() {
            analyzeBtn.disabled = !apiKeyInput.value || !fileInput.files[0];
        }

        apiKeyInput.addEventListener('input', updateButtonState);
        fileInput.addEventListener('change', updateButtonState);

        async function extractTextFromPdf(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let text = '';
            
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const content = await page.getTextContent();
                text += content.items.map(item => item.str).join(' ') + '\n';
            }
            
            return text;
        }

        function formatResults(analysis) {
            try {
                const data = JSON.parse(analysis);
                let html = '';
                
                if (data.summary) {
                    html += `
                        <div class="result-section">
                            <h3>Executive Summary</h3>
                            <p>${data.summary}</p>
                        </div>
                    `;
                }
                
                if (data.key_points && data.key_points.length) {
                    html += `
                        <div class="result-section">
                            <h3>Key Points</h3>
                            <ul>
                                ${data.key_points.map(point => `<li>${point}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                if (data.insights && data.insights.length) {
                    html += `
                        <div class="result-section">
                            <h3>Key Insights</h3>
                            <ul>
                                ${data.insights.map(insight => `<li>${insight}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                if (data.recommendations && data.recommendations.length) {
                    html += `
                        <div class="result-section">
                            <h3>Recommendations</h3>
                            <ul>
                                ${data.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                return html;
            } catch (e) {
                return `<div class="result-section">${analysis}</div>`;
            }
        }

        // Modified analyze function to use CORS proxy
        async function analyzePdfWithClaude(text) {
            const prompt = `Please analyze the following text from a PDF document. Provide a comprehensive analysis in JSON format with the following structure:
{
    "summary": "A concise 2-3 sentence executive summary of the main content",
    "key_points": [
        "List of 3-5 main points or arguments from the text"
    ],
    "insights": [
        "List of 2-3 meaningful insights or implications drawn from the content"
    ],
    "recommendations": [
        "List of 2-3 actionable recommendations or next steps based on the content"
    ]
}

Make sure the analysis is specific to the content and avoid generic statements. If any section is not relevant to the content, you may omit it from the JSON structure.

Here is the text to analyze:

${text}`;

            // Using cors-proxy.htmldriven.com as an example CORS proxy
            const proxyUrl = 'https://cors-proxy.htmldriven.com/go/?url=';
            const targetUrl = 'https://api.anthropic.com/v1/messages';
            
            const response = await fetch(proxyUrl + encodeURIComponent(targetUrl), {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': apiKeyInput.value,
                    'anthropic-version': '2023-06-01'
                },
                body: JSON.stringify({
                    model: 'claude-3-haiku-20240307',
                    max_tokens: 1024,
                    messages: [{
                        role: 'user',
                        content: prompt
                    }]
                })
            });

            if (!response.ok) {
                throw new Error(`API Error: ${response.status}`);
            }

            const data = await response.json();
            return data.content[0].text;
        }

        // Handle analyze button click
        analyzeBtn.addEventListener('click', async () => {
            try {
                resultDiv.textContent = '';
                loadingDiv.style.display = 'block';
                analyzeBtn.disabled = true;

                const file = fileInput.files[0];
                const text = await extractTextFromPdf(file);
                const analysis = await analyzePdfWithClaude(text);
                resultDiv.innerHTML = formatResults(analysis);
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            } finally {
                loadingDiv.style.display = 'none';
                analyzeBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
