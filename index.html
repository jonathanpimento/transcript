<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Podcast Transcript Analyzer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
            line-height: 1.5;
        }
        .container {
            background-color: #f9fafb;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .api-key-input {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
        }
        .file-input-wrapper {
            margin-bottom: 1rem;
        }
        #analyzeBtn {
            background-color: #2563eb;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }
        #analyzeBtn:disabled {
            background-color: #93c5fd;
            cursor: not-allowed;
        }
        #result {
            margin-top: 1rem;
            white-space: pre-wrap;
        }
        .error {
            color: #dc2626;
            margin-top: 0.5rem;
        }
        .loading {
            display: none;
            margin-top: 1rem;
            color: #4b5563;
        }
        .result-section {
            margin-top: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 4px;
            border: 1px solid #e5e7eb;
        }
        .result-section h3 {
            color: #1e3a8a;
            font-size: 1.25rem;
            margin: 0 0 1rem 0;
        }
        .result-section h4 {
            color: #4b5563;
            font-size: 1rem;
            margin: 1rem 0 0.5rem 0;
        }
        .speaker-section {
            margin-bottom: 2rem;
            padding: 1rem;
            background: #f8fafc;
            border-radius: 6px;
        }
        .speaker-section h4 {
            color: #1e40af;
            margin: 0 0 1rem 0;
            font-size: 1.1rem;
        }
        .speaker-section h5 {
            color: #4b5563;
            margin: 1rem 0 0.5rem 0;
            font-size: 0.95rem;
        }
        blockquote {
            border-left: 3px solid #2563eb;
            margin: 0.5rem 0;
            padding: 0.5rem 0 0.5rem 1rem;
            font-style: italic;
            color: #4b5563;
        }
        ul {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }
        li {
            margin-bottom: 0.5rem;
        }
        .social-share {
            background: #f0f9ff;
            padding: 1rem;
            border-radius: 4px;
            margin-top: 0.5rem;
        }
        .copy-btn {
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
            cursor: pointer;
            float: right;
        }
        .copy-btn:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Podcast Transcript Analyzer</h1>
        
        <div>
            <label for="apiKey">Claude API Key:</label>
            <input type="password" id="apiKey" class="api-key-input" placeholder="Enter your API key">
        </div>

        <div class="file-input-wrapper">
            <label for="pdfFile">Select Transcript PDF:</label>
            <input type="file" id="pdfFile" accept=".pdf">
        </div>

        <button id="analyzeBtn" disabled>Analyze Transcript</button>
        
        <div id="loading" class="loading">
            Analyzing transcript... This may take a few moments.
        </div>
        
        <div id="result"></div>
    </div>

    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        const apiKeyInput = document.getElementById('apiKey');
        const fileInput = document.getElementById('pdfFile');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const resultDiv = document.getElementById('result');
        const loadingDiv = document.getElementById('loading');

        function updateButtonState() {
            analyzeBtn.disabled = !apiKeyInput.value || !fileInput.files[0];
        }

        apiKeyInput.addEventListener('input', updateButtonState);
        fileInput.addEventListener('change', updateButtonState);

        async function extractTextFromPdf(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
            let text = '';
            
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const content = await page.getTextContent();
                text += content.items.map(item => item.str).join(' ') + '\n';
            }
            
            return text;
        }

        function addCopyButtons() {
            document.querySelectorAll('.social-share').forEach(shareDiv => {
                const text = shareDiv.textContent;
                const copyBtn = document.createElement('button');
                copyBtn.textContent = 'Copy';
                copyBtn.className = 'copy-btn';
                copyBtn.onclick = async () => {
                    await navigator.clipboard.writeText(text);
                    copyBtn.textContent = 'Copied!';
                    setTimeout(() => copyBtn.textContent = 'Copy', 2000);
                };
                shareDiv.insertBefore(copyBtn, shareDiv.firstChild);
            });
        }

        function formatResults(analysis) {
            try {
                const data = JSON.parse(analysis);
                let html = '';
                
                // Podcast Summary
                if (data.podcastSummary) {
                    html += `
                        <div class="result-section">
                            <h3>Podcast Summary</h3>
                            <p>${data.podcastSummary}</p>
                        </div>
                    `;
                }
                
                // Social Share Text
                if (data.socialShareText) {
                    html += `
                        <div class="result-section">
                            <h3>Social Media Content</h3>
                            ${data.socialShareText.twitter ? `
                                <h4>Twitter</h4>
                                <div class="social-share">${data.socialShareText.twitter}</div>
                            ` : ''}
                            ${data.socialShareText.linkedin ? `
                                <h4>LinkedIn</h4>
                                <div class="social-share">${data.socialShareText.linkedin}</div>
                            ` : ''}
                        </div>
                    `;
                }
                
                // Speaker Insights
                if (data.speakerInsights && data.speakerInsights.length) {
                    html += `
                        <div class="result-section">
                            <h3>Speaker Insights</h3>
                            ${data.speakerInsights.map(speaker => `
                                <div class="speaker-section">
                                    <h4>${speaker.name}</h4>
                                    ${speaker.keyPoints && speaker.keyPoints.length ? `
                                        <h5>Key Points</h5>
                                        <ul>
                                            ${speaker.keyPoints.map(point => `<li>${point}</li>`).join('')}
                                        </ul>
                                    ` : ''}
                                    ${speaker.bestQuote ? `
                                        <h5>Notable Quote</h5>
                                        <blockquote>${speaker.bestQuote}</blockquote>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                // Categories
                if (data.podcastCategories) {
                    html += `
                        <div class="result-section">
                            <h3>Podcast Categories</h3>
                            <p><strong>Primary Category:</strong> ${data.podcastCategories.primaryCategory}</p>
                            ${data.podcastCategories.subCategories && data.podcastCategories.subCategories.length ? `
                                <p><strong>Sub-Categories:</strong> ${data.podcastCategories.subCategories.join(', ')}</p>
                            ` : ''}
                        </div>
                    `;
                }
                
                return html;
            } catch (e) {
                return `<div class="result-section">${analysis}</div>`;
            }
        }

        async function analyzePdfWithClaude(text) {
            const prompt = `Analyze this podcast transcript and provide insights in the following JSON format:

{
    "podcastSummary": "A concise 2-3 sentence summary of the overall podcast discussion",
    
    "socialShareText": {
        "twitter": "An engaging, catchy 280-character summary suitable for Twitter",
        "linkedin": "A professional, compelling 1-2 sentence summary suitable for LinkedIn"
    },
    
    "speakerInsights": [
        {
            "name": "Speaker's name",
            "keyPoints": [
                "3-4 main points or insights from this speaker"
            ],
            "bestQuote": "Most impactful or meaningful quote from this speaker"
        }
    ],
    
    "podcastCategories": {
        "primaryCategory": "Main category (e.g., Technology, Business, Science)",
        "subCategories": [
            "2-3 more specific subcategories"
        ]
    }
}

Important instructions:
1. First identify different speakers from the transcript context
2. For social text, make it engaging and include relevant hook/value proposition
3. For quotes, prioritize unique, insightful, or memorable statements
4. For categories, be specific but use standard category names
5. Ensure speaker insights capture their unique perspectives and expertise

Here is the podcast transcript to analyze:

${text}`;

            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': apiKeyInput.value,
                    'anthropic-version': '2023-06-01',
                    'anthropic-dangerous-direct-browser-access': 'true'
                },
                body: JSON.stringify({
                    model: 'claude-3-haiku-20240307',
                    max_tokens: 1024,
                    messages: [{
                        role: 'user',
                        content: prompt
                    }]
                })
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`API Error: ${response.status} ${errorText}`);
            }

            const data = await response.json();
            return data.content[0].text;
        }

        analyzeBtn.addEventListener('click', async () => {
            try {
                resultDiv.textContent = '';
                loadingDiv.style.display = 'block';
                analyzeBtn.disabled = true;

                const file = fileInput.files[0];
                const text = await extractTextFromPdf(file);
                const analysis = await analyzePdfWithClaude(text);
                resultDiv.innerHTML = formatResults(analysis);
                addCopyButtons();
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            } finally {
                loadingDiv.style.display = 'none';
                analyzeBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
