<!DOCTYPE html>
<html lang="en">
<!-- Previous head and style sections remain the same -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Analyzer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        /* ... previous styles ... */
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
            line-height: 1.5;
        }
        .container {
            background-color: #f9fafb;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        /* ... other styles remain the same ... */
    </style>
</head>
<body>
    <!-- Previous HTML remains the same -->
    <div class="container">
        <h1>PDF Analyzer</h1>
        
        <div>
            <label for="apiKey">Claude API Key:</label>
            <input type="password" id="apiKey" class="api-key-input" placeholder="Enter your API key">
        </div>

        <div class="file-input-wrapper">
            <label for="pdfFile">Select PDF:</label>
            <input type="file" id="pdfFile" accept=".pdf">
        </div>

        <button id="analyzeBtn" disabled>Analyze PDF</button>
        
        <div id="loading" class="loading">
            Analyzing PDF... This may take a few moments.
        </div>
        
        <div id="result"></div>
    </div>

    <script>
        // Previous functions remain the same until analyzePdfWithClaude
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        const apiKeyInput = document.getElementById('apiKey');
        const fileInput = document.getElementById('pdfFile');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const resultDiv = document.getElementById('result');
        const loadingDiv = document.getElementById('loading');

        // ... other helper functions remain the same ...

        async function analyzePdfWithClaude(text) {
            const prompt = `Please analyze the following text from a PDF document. Provide a comprehensive analysis in JSON format with the following structure:
{
    "summary": "A concise 2-3 sentence executive summary of the main content",
    "key_points": [
        "List of 3-5 main points or arguments from the text"
    ],
    "insights": [
        "List of 2-3 meaningful insights or implications drawn from the content"
    ],
    "recommendations": [
        "List of 2-3 actionable recommendations or next steps based on the content"
    ]
}

Make sure the analysis is specific to the content and avoid generic statements. If any section is not relevant to the content, you may omit it from the JSON structure.

Here is the text to analyze:

${text}`;

            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'x-api-key': apiKeyInput.value,
                    'anthropic-version': '2023-06-01',
                    'anthropic-dangerous-direct-browser-access': 'true'  // Added required header
                },
                body: JSON.stringify({
                    model: 'claude-3-haiku-20240307',
                    max_tokens: 1024,
                    messages: [{
                        role: 'user',
                        content: prompt
                    }]
                })
            });

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`API Error: ${response.status} ${errorText}`);
            }

            const data = await response.json();
            return data.content[0].text;
        }

        // Previous event listener code remains the same
        analyzeBtn.addEventListener('click', async () => {
            try {
                resultDiv.textContent = '';
                loadingDiv.style.display = 'block';
                analyzeBtn.disabled = true;

                const file = fileInput.files[0];
                const text = await extractTextFromPdf(file);
                const analysis = await analyzePdfWithClaude(text);
                resultDiv.innerHTML = formatResults(analysis);
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            } finally {
                loadingDiv.style.display = 'none';
                analyzeBtn.disabled = false;
            }
        });
    </script>
</body>
</html>
